<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>AUX Examples</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type=module src="src/index.js"></script>
    <script type=module>
      const examples = [
        "Button.html",
        "Buttons.html",
        "Clock.html",
        "ColorPicker.html",
        "ColorPickerDialog.html",
        "ConfirmButton.html",
        "Chart.html",
        "Crossover.html",
        "Dialog.html",
        "Dynamics.html",
        "Equalizer.html",
        "Fader.html",
        "Gauge.html",
        "Knob.html",
        "LevelMeter.html",
        "Meter.html",
        "MultiMeter.html",
        "Navigation.html",
        "Pager.html",
        "Pages.html",
        "Scale.html",
        "Select.html",
        "Slider.html",
        "State.html",
        "Toggle.html",
        "Value.html",
        "ValueButton.html",
        "ValueKnob.html"
      ];

      import { html } from './src/utils/dom.js';

      window.addEventListener('load', function() {
        const hash = window.location.hash.substr(1);
        let filter = null;

        if (hash !== '' && parseInt(hash).toString() !== hash)
        {
          filter = hash.toLowerCase().split(',');
        }

        const root = document.querySelector('aux-root');
        const tasks = examples.map(async (file) => {
          const tmp = file.split('.');
          tmp.pop();
          const name = tmp.join('.');

          if (filter && filter.indexOf(name.toLowerCase()) === -1)
          {
            return;
          }

          const frame = document.createElement('aux-frame');
          frame.setAttribute('label', name);
          root.appendChild(frame);

          const res = await window.fetch('examples/' + file);
          frame.appendChild(html(await res.text()));
        });
        Promise.all(tasks).then(() => {
          setTimeout(function () {
            if (filter === null)
            {
              window.scrollTo(0, parseInt(hash));
              document.addEventListener("scroll", function () {
                let s = parseInt(document.children[0].scrollTop);
                window.location.hash = "#" + s;
              });
            }

            document.querySelectorAll('.aux-widget').forEach((node) => {
              if (!node.tagName.startsWith('AUX')) return;
              node.addEventListener('dblclick', (ev) => {
                console.log(node.tagName);
                node.constructor.observedAttributes.forEach((name) => {
                  if (!node.hasAttribute(name)) return;
                  const widget = node.auxWidget();
                  console.log('%s %o %o', name, node.getAttribute(name),
                              widget.get(name));
                });
                ev.stopPropagation();
              });
            });
          }, 100);
        });
      });

    </script>
    
    <link rel="stylesheet" id=stylesheet href="styles/aux.css" />
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            font-size: 14px;
        }
        #logo {
            width: 96px;
            height: 96px;
            float: right;
            margin: 0 0 8px 16px;
        }
        #wrapper {
            clear: both;
            padding: 16px;
        }
        #wrapper > aux-frame {
            display: block;
            margin-bottom: 20px;
        }
    </style>
    
    
  </head>
  <body>
    
    <img src="logo.png" id=logo>
    <h1>AUX Examples</h1>
    <p>
        This is a collection of AUX widgets in different configurations
        for demonstration and guideline purposes. to get an insight into
        structure and relation, browsers with developer tools
        (try <code>F12</code>) are recommended.
    </p>
    
    <aux-root id="wrapper"></aux-root>
    
  </body>
  
</html>
